<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Téléchargement…</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="robots" content="noindex" />
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    body { display:flex; min-height:100dvh; align-items:center; justify-content:center; margin:0; }
    .card { max-width:640px; padding:24px; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.08); }
    .muted { opacity:.75 }
    .hidden { display:none }
    a.button { display:inline-block; padding:.6rem .9rem; border-radius:999px; border:1px solid #ccc; text-decoration:none }
  </style>
</head>
<body>
  <div class="card">
    <h1>On prépare votre téléchargement…</h1>
    <p class="muted">Si rien ne se passe, cliquez : <a id="manual" class="button" href="./fun.sh" download="fun.sh">télécharger maintenant</a></p>
    <p id="ok" class="muted">Le téléchargement devrait démarrer automatiquement.</p>
    <p id="err" class="hidden"><strong>Oups.</strong> Échec du téléchargement. Utilisez le lien ci-dessus.</p>
    <noscript><p><strong>JavaScript désactivé :</strong> utilisez le lien « télécharger maintenant ».</p></noscript>
  </div>

  <script>
    // Chemin et nom du fichier à télécharger
    const FILE_PATH = "./fun.sh";
    const FILE_NAME = "fun.sh";

    const manual = document.getElementById("manual");
    const ok = document.getElementById("ok");
    const err = document.getElementById("err");
    manual.href = FILE_PATH;
    manual.setAttribute("download", FILE_NAME);

    async function autoDownload() {
      try {
        // Récupère le fichier (même origine = OK sur GitHub Pages)
        const res = await fetch(FILE_PATH);
        if (!res.ok) throw new Error("HTTP " + res.status);

        // Force le téléchargement via un Blob (évite l’ouverture en onglet)
        const blob = await res.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = FILE_NAME;
        document.body.appendChild(a);
        a.click();
        a.remove();
        setTimeout(() => URL.revokeObjectURL(url), 1500);
      } catch (e) {
        console.error(e);
        ok.classList.add("hidden");
        err.classList.remove("hidden");
      }
    }

    window.addEventListener("load", () => {
      // petit délai pour laisser le navigateur initialiser
      setTimeout(autoDownload, 250);
    });
  </script>
</body>
</html>
